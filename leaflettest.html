<!DOCTYPE html>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.3/jquery.csv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>
    <style>
        #map {position: absolute; top: 0; left: 0; height: 60%; width: 100%;}
    </style>
</head>
<body>
    <div id = "map"></div>

    <script>
        const map = L.map('map').setView([61, 16], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        let brotts_data = null;
        const brotts_data_promise = fetch("anmalda_brott_json.json")
            .then(response => {
                return response.json();
            })
            .then(data => {
                console.log(data);
                brotts_data = data;
                return(data);
        });

        const geojson_data = fetch("geojson_kommuner.json")
        .then(response => {
            return response.json();
        })
        .then(data => {
            //Add the polygon for kommun 0 to the m
            async function handleData() {
                let brotts_data = await brotts_data_promise;

                function style(feature) {
                    let featureIndex = data.features.indexOf(feature);

                    if (brotts_data[featureIndex].crimesRelative >= 8000) {
                        return {color: "red"};
                    } else {
                        return {color: "green"};
                    }
                }
                var layer = L.geoJson(data, {style: style,})
                .bindPopup(function (layer) {
                    return layer.feature.properties.KnNamn;
                })
                .addTo(map);

                var marker = L.marker([51.5, -0.09]).addTo(map);
                return;

            }

            handleData();

            
        });
        // Create a style function that returns the style dict for a feature
        // using a getColor function that takes in kommunnummer from and gives
        // color from data of that kommunnummer

        

        

    </script>
</body>
</html>